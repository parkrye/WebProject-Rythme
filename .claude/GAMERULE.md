# 게임 규칙서

## 게임 개요
**네트워크 웹 리듬 퍼즐 게임**

출제자가 피아노로 멜로디를 연주하면, 다른 플레이어들이 해당 멜로디를 듣고 따라 연주하여 가장 비슷하게 연주한 사람이 점수를 얻는 멀티플레이어 게임

---

## 게임 흐름

```
[닉네임 입력] → [대기방] → [방 입장] → [게임 시작] → [라운드 반복] → [최종 결과]
```

---

## 참가자 규칙

| 항목 | 값 |
|------|-----|
| 최소 인원 | 2명 (AI 포함 가능) |
| 최대 인원 | 6명 |
| AI 플레이어 | 방장이 빈 슬롯에 추가 가능 |

### 역할
- **방장**: 방을 생성한 플레이어. 게임 시작, AI 추가 권한 보유
- **출제자**: 현재 턴에서 멜로디를 녹음하는 플레이어
- **도전자**: 출제자의 멜로디를 따라 연주하는 플레이어

---

## 라운드 진행

### 게임 페이즈 흐름
```
idle → recording → listening → challenging → judging → result → (다음 턴 또는 종료)
```

### 1단계: 출제자 대기 (idle, 3초)
- 순번에 따라 자동 선정
- 출제 순서: 입장 순서대로 순환
- 화면에 출제자 표시 (👑 아이콘)

### 2단계: 녹음 (recording, 10초)
- **출제자만 피아노 연주 가능** (다른 플레이어 키보드 비활성화)
- "녹음 시작" 버튼 클릭 후 연주
- 녹음 중 연주한 음과 타이밍이 저장됨
- "녹음 완료" 버튼 또는 10초 경과로 종료

### 3단계: 문제 듣기 (listening, 5초)
- **모든 플레이어에게 출제자의 멜로디 자동 재생**
- 키보드 비활성화 상태
- 집중해서 멜로디 암기

### 4단계: 도전 (challenging, 15초)
- **출제자를 제외한 모든 플레이어가 녹음 방식으로 도전**
- "녹음 시작" 버튼 클릭 후 연주 (녹음 중에만 키보드 활성화)
- "제출" 버튼으로 완료 또는 15초 경과 시 자동 제출
- 미제출 시 해당 턴 0점 처리

### 5단계: 판정 (judging, 2초)
- 서버에서 각 도전자의 연주를 출제자 연주와 비교
- 유사도 계산 후 순위 결정

### 6단계: 결과 발표 (result, 8초)
- 라운드 승자 발표 (🏆 아이콘, 녹색 하이라이트)
- 출제자와 승자의 연주 재생 버튼 제공
- 획득 점수 및 등급 표시 (PERFECT/GREAT/GOOD/MISS)

---

## 피아노 규격

### 음역
| 구분 | 음 |
|------|-----|
| 흰 건반 | C4, D4, E4, F4, G4, A4, B4, C5 (8개) |
| 검은 건반 | C#4, D#4, F#4, G#4, A#4 (5개) |
| 총 | 13개 음 (1옥타브 + 1음) |

### 녹음 데이터 형식
```typescript
interface Note {
  note: string;      // 음 이름 (예: "C4", "F#4")
  timestamp: number; // 녹음 시작 기준 경과 시간 (ms)
}

// 예시
[
  { note: "C4", timestamp: 0 },
  { note: "E4", timestamp: 250 },
  { note: "G4", timestamp: 500 },
  { note: "C5", timestamp: 750 }
]
```

---

## 점수 시스템

### 유사도 계산 방식
| 요소 | 가중치 | 설명 |
|------|--------|------|
| 음 순서 | 50% | 연주한 음의 순서가 얼마나 일치하는지 |
| 타이밍 | 30% | 각 음의 연주 시점이 얼마나 일치하는지 |
| 음 개수 | 20% | 연주한 음의 총 개수가 얼마나 일치하는지 |

### 점수 부여
| 유사도 | 등급 | 출제자 점수 | 도전자 점수 |
|--------|------|-------------|-------------|
| 90% 이상 | PERFECT | +100 | +100 |
| 70~89% | GREAT | +70 | +70 |
| 50~69% | GOOD | +50 | +50 |
| 50% 미만 | MISS | +30 | +30 |
| 도전자 없음 | - | +20 | - |

### 보너스 점수
- **올 퍼펙트**: 모든 도전자가 90% 이상 → 출제자 +50 보너스
- **유일한 정답자**: 한 명만 70% 이상 → 해당 도전자 +30 보너스

---

## 라운드 시스템

### 총 턴 수 계산
```
총 턴 수 = 플레이어 수 × 3라운드
```

| 참가자 수 | 총 턴 수 | 설명 |
|-----------|----------|------|
| 2명 | 6턴 | 각 플레이어가 3번씩 출제 |
| 3명 | 9턴 | 각 플레이어가 3번씩 출제 |
| 4명 | 12턴 | 각 플레이어가 3번씩 출제 |
| 5명 | 15턴 | 각 플레이어가 3번씩 출제 |
| 6명 | 18턴 | 각 플레이어가 3번씩 출제 |

### 출제 순서
- 입장 순서대로 순환
- 라운드마다 같은 순서로 반복

---

## 승리 조건

### 턴 승리
- 해당 턴에서 가장 높은 유사도를 기록한 도전자

### 최종 승리
- 모든 턴 종료 후 총 점수가 가장 높은 플레이어
- 동점 시: 1등 횟수 > PERFECT 횟수 > 먼저 입장한 플레이어 순

---

## AI 플레이어

### 특징
- 방장만 추가 가능 (대기 중에만)
- 항상 준비 완료 상태
- 의도적으로 낮은 점수로 플레이 (플레이어가 이기기 쉬움)

### 난이도 (현재: Easy 고정)
| 난이도 | 목표 유사도 | 특징 |
|--------|-------------|------|
| Easy | 30~50% | 초보자도 쉽게 이길 수 있음 |

### AI 출제 패턴
- 간단한 멜로디 생성 (4~6개 음)
- 순차적 음 진행 (C4→D4→E4→F4 등)

### AI 도전 패턴
- 2~7초 랜덤 딜레이 후 자동 제출
- 의도적으로 음을 틀리거나 타이밍 오차 추가

---

## 특수 상황 처리

### 플레이어 이탈
- 게임 중 이탈 시 해당 플레이어 슬롯은 비워둠
- 남은 플레이어로 게임 계속 진행
- 이탈한 플레이어의 출제 턴은 건너뜀

### 방 삭제 조건
- 모든 사람 플레이어가 나가면 방 자동 삭제
- AI만 남아도 방 삭제

### 방장 이전
- 방장이 나가면 다른 사람 플레이어에게 자동 이전
- AI에게는 방장 이전되지 않음

---

## 시간 설정

| 페이즈 | 시간 |
|--------|------|
| idle | 3초 |
| recording | 10초 |
| listening | 5초 |
| challenging | 15초 |
| judging | 2초 |
| result | 8초 |
